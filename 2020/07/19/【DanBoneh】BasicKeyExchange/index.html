<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/apple-2.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="密码学,DanBoneh密码学," />




  


  <link rel="alternate" href="/atom.xml" title="鳕鱼堡er" type="application/atom+xml" />






<meta name="description" content="Trusted 3^rd parties两个用户可以通过共享一个密钥来保护通信数据，那么，这两个用户是如何产生这个共享密钥的？">
<meta property="og:type" content="article">
<meta property="og:title" content="【DanBoneh】Basic Key Exchange">
<meta property="og:url" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/index.html">
<meta property="og:site_name" content="鳕鱼堡er">
<meta property="og:description" content="Trusted 3^rd parties两个用户可以通过共享一个密钥来保护通信数据，那么，这两个用户是如何产生这个共享密钥的？">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%9C%A8%E7%BA%BF%E5%8F%AF%E4%BF%A1%E4%BB%BB%E7%AC%AC%E4%B8%89%E6%96%B9.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%88%A9%E7%94%A8%E7%8E%A9%E5%85%B7%E5%8D%8F%E8%AE%AE%E4%BA%A7%E7%94%9F%E5%85%B1%E4%BA%AB%E5%AF%86%E9%92%A5.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E7%8E%A9%E5%85%B7%E5%8D%8F%E8%AE%AE.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE%E5%9B%BE%E8%A1%A8%E5%BD%A2%E5%BC%8F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/tip.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Diffie-Hellman%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/DH%E5%87%BD%E6%95%B0%E5%AE%89%E5%85%A8%E6%80%A7.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E6%99%AE%E9%80%9A%E6%95%B0%E5%9F%9F%E7%AD%9B%E6%B3%95.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%9F%9F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Diffie-Hellman%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%80%A7%E8%B4%A8.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%862.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%89%E5%85%A8%E6%B8%B8%E6%88%8F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%B1%E4%BA%AB%E5%AF%86%E9%92%A5%E7%9A%84%E5%BB%BA%E7%AB%8B.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%AF%B9%E7%AA%83%E5%90%AC%E5%AE%89%E5%85%A8%E7%9A%84%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG">
<meta property="article:published_time" content="2020-07-19T00:54:38.000Z">
<meta property="article:modified_time" content="2020-07-19T10:02:32.000Z">
<meta property="article:author" content="XUEYU">
<meta property="article:tag" content="密码学">
<meta property="article:tag" content="DanBoneh密码学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%9C%A8%E7%BA%BF%E5%8F%AF%E4%BF%A1%E4%BB%BB%E7%AC%AC%E4%B8%89%E6%96%B9.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/07/19/【DanBoneh】BasicKeyExchange/"/>





  <title>【DanBoneh】Basic Key Exchange | 鳕鱼堡er</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?702343d7b417e8c7fb52c949a3414d6c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">鳕鱼堡er</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">种一棵树，最好的时间是是现在。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XUEYU">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鳕鱼堡er">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【DanBoneh】Basic Key Exchange</h1>
        

        <div class="post-meta">
          <span class="post-time">
			
			
			
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-19T08:54:38+08:00">
                2020-07-19
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-07-19T18:02:32+08:00">
                2020-07-19
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E8%B7%AF/" itemprop="url" rel="index">
                    <span itemprop="name">密码学之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/" class="leancloud_visitors" data-flag-title="【DanBoneh】Basic Key Exchange">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.3k字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  18分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="trusted-3rd-parties"><a href="#Trusted-3-rd-parties" class="headerlink" title="Trusted 3^rd parties"></a>Trusted 3^rd parties</h1><p>两个用户可以通过共享一个密钥来保护通信数据，那么，这两个用户是如何产生这个共享密钥的？</p>
<a id="more"></a>
<h2 id="密钥管理"><a href="#密钥管理" class="headerlink" title="密钥管理"></a>密钥管理</h2><p>试想，世界上有 n 位用户，那么这些用户如何管理这些密钥？</p>
<p>假设 n=4 ，一种方案是，每一对用户共享一对密钥，这样用户需要管理的共享密钥太多。</p>
<p>有一种方法叫<strong>在线可信任第三方</strong>，使用 TTP 表示可信任第三方，每个用户与可信任第三方共享一个单独的密钥，这个设计的好处是每个用户只需记住一个密钥。当 Alice 想和 Bob 通信时会发生什么？</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%9C%A8%E7%BA%BF%E5%8F%AF%E4%BF%A1%E4%BB%BB%E7%AC%AC%E4%B8%89%E6%96%B9.PNG" class title="在线可信任第三方">
<p>双方必须参加某个特定协议，在协议的最后，他们会共享一个密钥 K_AB ，而攻击者不能知道 K_AB ，Alice 想和 Bob <strong>如何生成这一共享密钥 K_AB</strong> ？</p>
<p>看一个玩具协议，<u>这个协议对窃听是安全的，对篡改或主动攻击不安全</u>，Alice 有她的密钥 $k_A$ ，Bob有他的密钥 $k_B$ ，$k_A$、$k_B$ 是与可信任第三方共享的。这个协议如下工作：</p>
<p>Alice 开始时会发送一条信息，给可信任第三方，说她想要一个密钥用于和Bob通信，可信任第三方会选择一个随机密钥 k_AB ，那么可信任第三方生成了他们的共享密钥，他会回复一条信息给 Alice ，这条信息包含两部分，①使用 $k_A$ 加密的信息，这个密钥在 Alice 和 Bob 之间使用，k_AB 包含在这条信息里，即，这里被加密的信息是，k_AB 加上“这个密钥是Alice 和 Bob的共享密钥”这一事实。②票据，这个票据是为 Bob 加密的信息，是使用 $k_B$ 加密的，加密的信息依然是“这个密钥在 Alice 和 Bob 之间使用”，然后 TTP 把这个事实附在密钥 k_AB 后面。这里使用的加密系统 E 是一个 CPA 安全密码，当 Alice 想与 Bob 通信时，Alice 会解密给她的那部分信息得到密钥 k_AB ，然后把票据给 Bob ，Bob 收到这个票据，使用 $k_B$ 解密得到密钥 k_AB ，他们就有了共享密钥。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%88%A9%E7%94%A8%E7%8E%A9%E5%85%B7%E5%8D%8F%E8%AE%AE%E4%BA%A7%E7%94%9F%E5%85%B1%E4%BA%AB%E5%AF%86%E9%92%A5.PNG" class title="利用玩具协议产生共享密钥">
<p><strong>为什么这个协议是窃听安全的？</strong></p>
<p>当我们只考虑对窃听的安全时，窃听者在这个协议中看到两个密文，我们的目标是，<u>窃听者没有任何关于交换密钥 k_AB 的信息</u>，这点可由密码 E,D 的 CPA 安全性直接得到。</p>
<p>对于每个密钥交换，TTP是必须使用的，这个协议的另一个性质是，TTP 知道所有的会话密钥，如果 TTP 被破解了，那么攻击者可以轻松获得所有系统中用户之间已经交换过的密钥。这个机制的优点是，它只使用对称密钥密码学，是快速有效的。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E7%8E%A9%E5%85%B7%E5%8D%8F%E8%AE%AE.PNG" class title="玩具协议">
<p><strong>这个协议对主动攻击是完全不安全的，如，重放攻击：</strong></p>
<p>设想 Alice 从 Bob 那里订购了一本书，Bob 接收了这本书的付款，然后发给 Alice 一份这本书的拷贝，交易完成。设想攻击者记下了 Alice 和在线商家 Bob 的会话，稍后向 Bob重放这段会话，Bob 就会认为，Alice刚刚重新订购了这本书的另一份拷贝，Bob 就会再收一次 Alice 的钱，然后发给 Alice 这份拷贝，所以，重放会话会对 Alice 造成巨大危害</p>
<p>我们能否设计出密钥交换协议，对窃听和主动攻击都保持安全呢？<strong>我们能否设计出安全的密钥交换协议，但不需要一个在线的可信任第三方呢？</strong>答案是可能的。事实上，这是公钥密码学的起点，思路如下：</p>
<p>①由 Ralph Merkle 于1974年提出。</p>
<p>②由 Diffie 与 Hellman 于 1976年提出。</p>
<p>③由 Rivest，Shamir，Adleman 于1977年提出。</p>
<p>近年的新想法：①基于身份的加密（IBE）2001。②泛函加密，2011。</p>
<h1 id="merkle-puzzles"><a href="#Merkle-Puzzles" class="headerlink" title="Merkle Puzzles"></a>Merkle Puzzles</h1><p>不借助可信第三方的密钥交换协议。</p>
<p>这里我们通常的设定是，有 Alice 和 Bob ，他们想生成一个共享密钥，他们互相发送信息，在协议的最后，他们必须获得某个双方都知道的共享密钥 k ，窃听通信流量的攻击者绝对无法得知这个 k 是什么，目前，我们只关心监听会话的攻击者，我们将看到三个协议来达到这一目标。</p>
<p>能借助对称密码学做到吗？可不可以只使用分组密码或哈希函数等？答案是肯定的，但是得到的协议<u>非常低效，在实际中从未被使用</u>，不过这些协议非常简单，<strong>Merkle 谜题协议工作流程</strong>如下：</p>
<p>这个协议的主要工具叫做一个“谜题”，谜题是指难解的问题，但通过努力还是可以解出的。假设我们有一个对称密码，使用 128 位密钥，以 AES 为例，假设我选择的 AES 密钥的前 96 位都是 0 ，只有剩下的 32 位是非零的，并随机选取的。现在我加密一段固定的明文，比如“message”，使用 128 位密钥，大部分位都是 0 ，加密的结果叫做“谜题”，称之为谜题是因为不难找到密钥 P ，只需要尝试 2^32 种可能性，看是否得到明文“message”，如果是的话，就知道已经发现了正确的 P 。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE.PNG" class title="Merkle谜题协议">
<p><strong>Merkle谜题协议工作方式</strong>如下：</p>
<p>Alice 开始时生成大量的谜题，特别地，她将生成 2^32 个不同的谜题，对于每个谜题，她生成的方法如下：选择一个 32 位 随机谜题 $P_i$ ，i 从 1 遍历 到 2^32 ，然后她再选择两个值 $x_i$ 和 $k_i$ ，每个 128 位，现在她会使用谜题 $P_i$ 作为一个 AES 密钥，前 96 位都是 0 ，后 32 位非零，所以这个密钥的熵是 32 位，如果只有 2^32 个密钥，现在他要使用这个密钥加密的明文是下图中红色部分的信息，她对所有的谜题都这么做<u>得到了 2^32 个不同的谜题，然后把所有的谜题发送给 Bob</u> 。</p>
<p>Bob 接收了 2^32 个不同的谜题，他只选择其中一个，不需要记住所有的谜题，比如说他选择了谜题 j ，他<u>花了 2^32 的时间来解决这个谜题</u>，他要检查明文的前面部分是否以“Puzzle”开头，如果是，Bob 就知道了他正确的解决了这个谜题，然后他就获得了嵌在谜题里的数据 $x_j$ 和 $k_j$ ，$x_j$ 是这个谜题的标记，$k_j$ 是他们要使用的秘密信息，<u>然后他把 $x_j$ 发送给 Alice</u> ，$k_j$ 自己保留，作为秘密。</p>
<p>Alice 查找谜题数据库，她会<u>查到谜题 $x_j$ ，就知道了 Bob 选择的密钥 $k_j$</u> ，他们就有了这个共享密钥。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F.PNG" class title="Merkle谜题协议工作方式">
<p>窃听者看着 n 个谜题发送过去，看到 Bob 返回了一个 $x_j$ ，攻击者并不知道 Bob 解的是哪个谜题，他看到的只是谜题中的随机值，为了破解这个协议，窃听者会解决所有的谜题，直到他找到正确的谜题里面有 $x_j$ ，那么攻击者就会还原 $k_j$ ，那么，攻击者要做多少工作？$n^2$ 。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Merkle%E8%B0%9C%E9%A2%98%E5%8D%8F%E8%AE%AE%E5%9B%BE%E8%A1%A8%E5%BD%A2%E5%BC%8F.PNG" class title="Merkle谜题协议图表形式">
<p><strong>我们能否只使用对称密码，做得比平方鸿沟更好呢？</strong>答案是未知的，我们不知道平方鸿沟是否是我们所能做到的最好的结果。</p>
<p>事实上，如果我们把分组密码或哈希函数当作黑盒神谕来使用，换句话说，参与者只能询问分组密码或询问哈希函数在特定点的值并获得结果，如果这些是参与者所能做到的全部，换句话说，参与者不能实际使用分组密码或哈希函数的实现，那么事实上有一个结果告诉我们，<strong>如果参与者只能询问分组密码在 n 个点的值，那么总有一个攻击运行在 n 平方的时间里</strong>。这就是说，如果你只能使用分组密码作为一个黑盒进行询问，那么无论交换什么密钥，这个密钥交换总有一个平方时间的攻击。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/tip.PNG" class title="tip">
<p>我们发现，我们需要比分组密码和哈希函数更多的技术，实际上，我们需要具备非常特殊性质的函数，为了构建这些函数，我们实际上必须依赖于某些代数。</p>
<h1 id="the-diffie-hellman-protocol"><a href="#The-Diffie-Hellman-protocol" class="headerlink" title="The Diffie-Hellman protocol"></a>The Diffie-Hellman protocol</h1><h2 id="diffie-hellman-协议"><a href="#Diffie-Hellman-协议" class="headerlink" title="Diffie-Hellman 协议"></a>Diffie-Hellman 协议</h2><p>这是我们第一个实用的密钥交换机制。</p>
<p>Alice 和 Bob 素未谋面，却想交换一个共享密钥，然后他们可以使用这个密钥来用于相互安全通信，我们只看对窃听攻击的安全性，攻击者不能篡改网络中的数据，在密钥交换协议的最后，Alice 和 Bob 应该有一个共享密钥，但窃听攻击者无法知道交换的密钥是什么。<strong>我们能否做与Merkle谜题协议同样的事情，但现在能获得一个指数级鸿沟，横亘在攻击者和参与者的工作之间？</strong>我们不能仅凭分组密码技术获得这个指数级鸿沟，我们必须使用拥有比对称原型更多结构的难解问题，那么我们使用一点代数。</p>
<p><strong>Diffie-Hellman 协议是如何工作的呢？</strong></p>
<p>首先，我们选某个固定的大质数，记为 p ，然后我们选一个固定的整数 g ，g 正好在从 1 到 p 的范围中，这里的 p 和 g 是 Diffie-Hellman 协议的参数，它们一经选择就不再改变。这个协议如下工作：</p>
<p>开始时， Alice 选择某个随机数 a ，范围是 1 到 p-1 ，然后她将计算 $g^a$ (mod p) ，这是可以有效计算的，我们把这个计算的结果记为 A ，发送给 Bob 。现在，Bob 做同样的事情，他选择一个随机数 b ，范围是 1 到 p-1 ，计算 $g^b$ (mod p) ，结果记为 B ，发送给 Alice 。现在他们宣布已经共享了一个密钥，那么<strong>这个共享的密钥是什么呢？</strong>我们记为 k_AB = g^(ab) (mod p) 。事实上，双方都可以计算 k_AB ，Alice 可以取值 B ，计算 $B^a$ (mod p) ，获得 g^(ab) (mod p) ，Bob 也可以做类似的事情。这个协议顺利工作的本质原因是<strong>指数的代数性质</strong>。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Diffie-Hellman%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG" class title="Diffie-Hellman协议的工作过程">
<p><strong>为什么这个协议是安全的？</strong></p>
<p>窃听者能看到什么？他能看到质数 p 和生成元 g ，这些值是永远固定不变的，每个人都知道它们，攻击者还能看到 Alice 发送给 Bob 的 A 和 Bob 发送给 Alice 的 B ，那么，窃听者能计算出 g^(ab) (mod p) 吗？更一般地，我们定义 DH 函数，我们说 DH 函数定义在 g 上，给定 $g^a$ 和 $g^b$ ，能否计算 g^(ab) ？p 大约有 600 个十进制位，计算这个很大的质数模 p 乘法群上的函数，有多困难？</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/DH%E5%87%BD%E6%95%B0%E5%AE%89%E5%85%A8%E6%80%A7.PNG" class title="DH函数安全性">
<p>目前已知的事实，这个质数正好有 n 位长，计算 DH 函数已知最好的算法是一个更为一般的算法，用来计算离散对数函数，这个算法叫做<strong>普通数域筛法</strong>。这个算法的运行时间是指数级的，运行时间大约是 e 的 n 的立方根次方，事实上这个算法的运行时间的严格表达式要比这个复杂的多，这个算法有时叫做<strong>亚指数算法</strong>，因为这里的指数项正比于 n 的立方根，而不是 n ，这说明即使这个问题很难，它也不是真正的指数级时间的问题，运行时间的指数是与 n 的立方根成正比的。</p>
<p>看几个例子，如果你的密码有 80 位密钥，那大概需要 1000 位的模，这个算法是说我们可以以时间大约是 e 的 1024 的立方根次方解决 DH 问题，这不是很准确，事实上指数上有一些常数项。这个例子告诉大家，如果有一个亚指数级算法，即使看到这个问题规模很大，比如 1000 位，因为这个立方根的作用，其实总体并没有那么大。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E6%99%AE%E9%80%9A%E6%95%B0%E5%9F%9F%E7%AD%9B%E6%B3%95.PNG" class title="普通数域筛法">
<p><strong>如果要使用 Diffie-Hellman 协议来交换会话密钥，用于分组密码的会话密钥要有合适的密钥大小，使得密钥交换协议的安全性和之后使用的分组密码的安全性相当。</strong></p>
<p>计算在椭圆曲线域上的 Diffie-Hellman 函数要比计算质数模乘法上的 Diffie-Hellman 困难得多，因为问题更加困难，可以使用小得多的代数对象。这些模在椭圆曲线上增长的不快，通常从使用模算术到使用椭圆曲线域有一个缓慢的转换。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%9F%9F.PNG" class title="椭圆曲线域">
<h2 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h2><p>Diffie-Hellman 协议对抗主动攻击时，是完全不安全的，当存在<strong>中间人攻击</strong>时，我们需要对这个协议做些补充，让它对中间人攻击也是安全的。</p>
<p><strong>这个协议为什么对主动攻击是不安全的？</strong></p>
<p>假设我们有中间人 MiTM 试图窃听 Alice 和 Bob 之间的会话，协议开始时，Alice 发送 $g^a$ 给 Bob ，中间人截获了这个 $g^a$ ，他将取 Alice 发出的信息，换成他自己的信息，记为 A’ ，写成 $g^a$’ ，中间人选择了他自己的 a’ ，发送给 Bob 。</p>
<p>Bob并不知道中间人对通信流量做了手脚，他只能获得 A’ ，Bob 会回复他的值 B ，$g^b$ 给 Alice ，中间人截获 B ，产生自己的 b’ ，然后发送 B’=$g^b$’ 给 Alice 。</p>
<p>Alice 将计算她的密钥得到 g^(ab’) ，Bob 计算他的密钥 g^(ba’) ，而对于中间人，他既知道 A’ ，又知道 B’ ，他可以计算 g^(ab’) ，也可以计算 g^(ba’) ，因此现在它可以扮演中间人。</p>
<p>当 Alice 发送一个加密的信息给 Bob ，中间人可以轻松解密这个信息，然后中间人重新使用 Bob 的密钥加密这个信息发送给 Bob ，这样 Alice 发送信息给 Bob ，Bob 接收信息认为这个信息是安全的。中间人可以完全读到信息内容，如果他愿意，可以修改它，所以这个协议是完全不安全的。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG" class title="中间人攻击">
<h2 id="diffie-hellman-协议的非互动性"><a href="#Diffie-Hellman-协议的非互动性" class="headerlink" title="Diffie-Hellman 协议的非互动性"></a>Diffie-Hellman 协议的非互动性</h2><p>这个协议可以被视为一个非互动的协议，设想我们有一组几百万用户，他们中每个都将选取一个随机的私密值，然后在他们的 Facebook 页面上写下他们对 Diffie-Hellman 协议的贡献。</p>
<p>现在，如果 Alice 和 Charlie 想建立一个共享密钥，他们无需相互通信，Alice 只要去 Charlie 的公共页面，Charlie 只要去 Alice 的公共页面，刹那间，他们就共享了一个密钥，Alice 知道了 g^ca ，Charlie 知道了 g^ac ，某种意义上，一旦他们在公共页面发布了他们对 Diffie-Hellman 协议的共享，他们根本不需要互相通信就能建立共享密钥。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/Diffie-Hellman%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%80%A7%E8%B4%A8.PNG" class title="Diffie-Hellman协议的性质">
<p><strong>开放问题</strong>：我们能否对多于两方的用户做这些呢？换句话说，比如我们有 4 方，所有人都在他们的 Facebook 公共页面上发布了他们的值，现在我们想只通过阅读 Facebook 页面，所有人都可以建立共享密钥。我们是否可以非互动的建立这些共享密钥？n=2 就是 Diffie-Hellman 协议；n=3 ，我们也知道怎么做，有一个已知的协议由 Joux 提出的使用了非常高级的数学；对于 n=4,5… 这个问题是完全开放的，即使只有 4 人，我们也不知道怎么做。</p>
<h1 id="public-key-encryption"><a href="#Public-key-encryption" class="headerlink" title="Public-key encryption"></a>Public-key encryption</h1><p>一个基于公钥加密的不同的方法，依然只看对窃听的安全性，不允许攻击者修改数据或实施其他形式的主动攻击。</p>
<h2 id="公钥加密"><a href="#公钥加密" class="headerlink" title="公钥加密"></a>公钥加密</h2><p>就像对称加密一样，有一个加密算法和解密算法，不过这里的加密算法有一个密钥，叫做<strong>公钥</strong> PK，这个公钥属于 Bob ，而解密算法有一个不同的密钥，叫做<strong>私钥</strong> SK，也属于 Bob 。这两个密钥优势叫做<strong>密钥对</strong>。通常，加密这个信息的算法是，加密算法产生一个使用公钥加密的密文，当密文交给解密算法时，解密算法会输出对应的明文</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86.PNG" class title="公钥加密">
<p>公钥加密实际上由三个算法组成：密钥生成算法 G，E，D。当运行 G 时，会产生两个密钥，分别是公钥和私钥，通常，我们有<u>一致性</u>，即密钥生成算法输出的公钥和私钥，如果我们使用公钥加密明文，然后使用私钥解密，我们可以获得最初的明文。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%862.PNG" class title="公钥加密2">
<h2 id="公钥加密系统的安全游戏"><a href="#公钥加密系统的安全游戏" class="headerlink" title="公钥加密系统的安全游戏"></a>公钥加密系统的安全游戏</h2><p>使用与之前用过的语义安全同样的概念，但游戏不同。这里，挑战者运行密钥生成算法来产生一对公钥和私钥，他会把公钥给攻击者，挑战者对私钥进行保密。攻击者会输出两个长度相等的明文 $m_0$ 和 $m_1$ ，挑战者会给攻击者 $m_0$ 或 $m_1$ 的加密结果，我们定义两个实验，在 实验0 中，攻击者得到 $m_0$ 加密的结果，在 实验1 中，攻击者得到 $m_1$ 加密的结果，攻击者的目标是<u>猜他得到的是哪个明文的加密结果</u>，我们把他的猜测作为 实验0 或 实验1 的输出。在公钥加密中，没必要赋予攻击者以实施选择明文攻击的能力，因为在对称密钥系统中，攻击者必须请求他选择的明文的加密，而在公钥系统中，攻击者拥有公钥，他可以自己加密任何他想加密的明文。</p>
<p>我们说，如果攻击者无法区分 实验0 和 实验1 ，一个公钥系统 (G,E,D) 是语义安全的。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%89%E5%85%A8%E6%B8%B8%E6%88%8F.PNG" class title="公钥加密系统的安全游戏">
<h2 id="共享密钥的建立"><a href="#共享密钥的建立" class="headerlink" title="共享密钥的建立"></a>共享密钥的建立</h2><p>①Alice 开始时会使用密钥生成算法为自己产生一个随机公钥、密钥对，然后把公钥 PK 发送给 Bob ，并告诉 Bob 这个信息来自 Alice 。</p>
<p>②Bob 会产生一个随机的 128 位值 x ，回复 Alice 这个信息来自 Bob ，他还会返回用 Alice 的公钥加密的 x 。</p>
<p>③Alice 收到这个密文使用私钥进行解密，解密结果会给她值 x 。</p>
<p>现在，x 可以被用来作为双方共享的密钥。</p>
<p>这与 Diffie-Hellman协议 很不相同，这里双方必须有先后的通信，Bob 不能发送他的信息，直到他收到了 Alice 的信息，换句话说，Bob 不能用 Alice 的公钥加密 x ，直到他收到了 Alice 的公钥。即使在 Facebook 发布了公钥，依然需要先发送信息 x 才能建立共享密钥。但在 Diffie-Hellman协议中，双方可以在任何时候发送他们的信息，没有对信息的发送顺序的强制要求。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%B1%E4%BA%AB%E5%AF%86%E9%92%A5%E7%9A%84%E5%BB%BA%E7%AB%8B.PNG" class title="共享密钥的建立">
<p><strong>为什么这个协议是安全的？（只考虑对窃听的安全）</strong></p>
<p>在这个协议中，攻击者看到这个公钥和用公钥加密的 x ，他想得到 x ，现在我们知道这个公钥系统是语义安全的，这意味着攻击者不能区分 x 的加密和某个随机信息的加密，它仅仅是一个随机值，攻击者不能猜到。</p>
<p>即使这个协议对窃听是安全的，对抗中间人攻击时，它也是完全不安全的。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%AF%B9%E7%AA%83%E5%90%AC%E5%AE%89%E5%85%A8%E7%9A%84%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86.PNG" class title="对窃听安全的公钥加密">
<h2 id="中间人攻击"><a href="#中间人攻击-1" class="headerlink" title="中间人攻击"></a>中间人攻击</h2><p>Alice 产生她的公钥、密钥对，中间人也产生他自己的公钥、密钥对，当 Alice 发送她的公钥给 Bob 时，中间人会截获这个公钥，然后对 Bob 说这个信息来自 Alice，Alice 的公钥是 PK’ 。</p>
<p>Bob 接收了这个信息，他认为自己获得了从 Alice 发来的信息，他会选择随机数 x 进行回复，它会返回用 PK’ 加密的 x ，中间人 截获这个信息，他会用其他信息来代替它，他的目标是确保这个密钥交换成功，中间人应该发送什么给 Alice 呢？我们把 Bob 发送的密文记为 c ，中间人使用自己的私钥解密 c 得知 x ，然后他继续用 Alice 的公钥加密 x ，把加密值发回给 Alice ，Alice 获得 x ，完成了与 Bob 的密钥交换。</p>
<p>中间人也知道这个 x ，中间人可以修改 Alice 和 Bob 互发的信息，这个协议是完全不安全的。</p>
<img src="/2020/07/19/%E3%80%90DanBoneh%E3%80%91BasicKeyExchange/%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG" class title="公钥加密的中间人攻击">
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i>
 密码学</a>
          
            <a href="/tags/DanBoneh%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i>
 DanBoneh密码学</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/15/%E3%80%90DanBoneh%E3%80%91OddsAndEnds/" rel="next" title="【DanBoneh】Odds And Ends">
                <i class="fa fa-chevron-left"></i> 【DanBoneh】Odds And Ends
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/07/23/%E3%80%90DanBoneh%E3%80%91NumberTheory/" rel="prev" title="【DanBoneh】Number Theory">
                【DanBoneh】Number Theory <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="XUEYU" />
            
              <p class="site-author-name" itemprop="name">XUEYU</p>
              <p class="site-description motion-element" itemprop="description">你只管善良，上天自有衡量。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
				<a href="/archives">

              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#trusted-3rd-parties"><span class="nav-number">1.</span> <span class="nav-text">Trusted 3^rd parties</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#密钥管理"><span class="nav-number">1.1.</span> <span class="nav-text">密钥管理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#merkle-puzzles"><span class="nav-number">2.</span> <span class="nav-text">Merkle Puzzles</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-diffie-hellman-protocol"><span class="nav-number">3.</span> <span class="nav-text">The Diffie-Hellman protocol</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#diffie-hellman-协议"><span class="nav-number">3.1.</span> <span class="nav-text">Diffie-Hellman 协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间人攻击"><span class="nav-number">3.2.</span> <span class="nav-text">中间人攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#diffie-hellman-协议的非互动性"><span class="nav-number">3.3.</span> <span class="nav-text">Diffie-Hellman 协议的非互动性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#public-key-encryption"><span class="nav-number">4.</span> <span class="nav-text">Public-key encryption</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#公钥加密"><span class="nav-number">4.1.</span> <span class="nav-text">公钥加密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#公钥加密系统的安全游戏"><span class="nav-number">4.2.</span> <span class="nav-text">公钥加密系统的安全游戏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#共享密钥的建立"><span class="nav-number">4.3.</span> <span class="nav-text">共享密钥的建立</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间人攻击"><span class="nav-number">4.4.</span> <span class="nav-text">中间人攻击</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
	  
	  
		
		<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
		<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
		
		<div class="widget-wrap">
			<h3 class="widget-title"></h3>
			<div id="myCanvasContainer" class="widget tagcloud">
				<canvas width="200" height="200" id="resCanvas" style="width=100%">
					<ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DanBoneh%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">DanBoneh密码学</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/" rel="tag">Node</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdb/" rel="tag">gdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vps/" rel="tag">vps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E4%BA%8E%E9%85%8D%E5%AF%B9%E7%9A%84%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">基于配对的密码学</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/" rel="tag">密码学原理与实践</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93%E5%BD%92%E7%BA%B3/" rel="tag">总结归纳</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E9%A2%98/" rel="tag">测试题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a><span class="tag-list-count">1</span></li></ul>
				</canvas>
			</div>
		</div>
		
		
		
		
<div style="">
  <canvas id="canvas" style="width:60%;" height="100" width="700">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
<!--访问量访问人数-->
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">
	  <span class="post-count">71.2k</span>
	</span>
	<span class="post-meta-divider">|</span>
	<span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>

&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
	<i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XUEYU</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




<span class="post-meta-divider">|</span>
<span id="timeDate"></span><span id="times"></span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("3/10/2020 12:00:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = " Running "+dnum+" Days "; 
    } 
setInterval("createtime()",250);
</script>
        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: false,
        appId: 'zSmUqaeGJut1H7flpYIH1eVP-gzGzoHsz',
        appKey: 'oNioHGf9lbC9krBNHyPsX05z',
        placeholder: '欢迎交流讨论...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("zSmUqaeGJut1H7flpYIH1eVP-gzGzoHsz", "oNioHGf9lbC9krBNHyPsX05z");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
  <!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
