<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="密码学,DanBoneh密码学," />




  


  <link rel="alternate" href="/atom.xml" title="鳕鱼堡er" type="application/atom+xml" />






<meta name="description" content="Active attack on CPA-secure encryption修改IV域的攻击例子在这个攻击者的例子中，他们可以篡改通信，因此完全破坏了CPA安全加密的安全性。这告诉我们，实际上那种方法提供的完整性和私密性也会被破坏，换句话说，如果我们要安全地对抗主动型攻击者，完整性和私密性，两者都必须保证。">
<meta property="og:type" content="article">
<meta property="og:title" content="【DanBoneh】Authenticated Encryption">
<meta property="og:url" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/index.html">
<meta property="og:site_name" content="鳕鱼堡er">
<meta property="og:description" content="Active attack on CPA-secure encryption修改IV域的攻击例子在这个攻击者的例子中，他们可以篡改通信，因此完全破坏了CPA安全加密的安全性。这告诉我们，实际上那种方法提供的完整性和私密性也会被破坏，换句话说，如果我们要安全地对抗主动型攻击者，完整性和私密性，两者都必须保证。">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TCPIP%E7%9A%84%E4%BE%8B%E5%AD%90.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/IPsec.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%8D%E8%83%BD%E8%8E%B7%E5%BE%97%E7%A7%81%E5%AF%86%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E6%94%BB%E5%87%BB%E8%80%85%E6%94%B9%E5%8F%98IV%E7%9A%84%E6%96%B9%E5%BC%8F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB%E7%9A%84%E4%BE%8B%E5%AD%90.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A4%E8%AF%81%E5%8A%A0%E5%AF%86%E5%AE%9A%E4%B9%89.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AF%86%E6%96%87%E5%AE%8C%E6%95%B4%E6%80%A7%E6%B8%B8%E6%88%8F.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BD%B1%E5%93%8D%E2%80%94%E8%AE%A4%E8%AF%81.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB%E7%9A%84%E4%BE%8B%E5%AD%90%E5%9B%9E%E9%A1%BE.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%9A%E4%B9%89.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%9A%E4%B9%892.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%B8%A6%E9%9A%8F%E6%9C%BAIV%E7%9A%84CBC%E4%B8%8D%E6%98%AFCCA%E5%AE%89%E5%85%A8%E7%9A%84.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E1.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E2.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E3.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E4.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/CPA%E5%AE%89%E5%85%A8%E5%8A%A0%E5%AF%86%E5%92%8CMAC%E7%9A%84%E7%BB%84%E5%90%88%E4%BE%8B%E5%AD%90.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/AEAD.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/MAC%E5%AE%89%E5%85%A8%E6%80%A7.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/OCB.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%80%E4%BA%9B%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TLS%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TLS%E8%AE%B0%E5%BD%95%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%BB%86%E8%8A%82.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A1%E6%95%B0%E5%99%A8%E9%98%BB%E6%AD%A2%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E7%9A%84%E8%AF%81%E6%98%8E.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%80%E4%B8%AA%E8%A2%AB%E7%A0%B4%E8%A7%A3%E7%9A%84%E5%8D%8F%E8%AE%AE.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A1%E6%97%B6%E6%94%BB%E5%87%BB.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A8.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A82.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A83.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/SSH%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E7%AE%80%E5%8C%96%E7%89%88%E6%9C%AC%E7%9A%84%E6%94%BB%E5%87%BB.PNG">
<meta property="og:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/Lesson.PNG">
<meta property="article:published_time" content="2020-07-11T00:43:14.000Z">
<meta property="article:modified_time" content="2020-07-15T10:22:32.000Z">
<meta property="article:author" content="XUEYU">
<meta property="article:tag" content="密码学">
<meta property="article:tag" content="DanBoneh密码学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TCPIP%E7%9A%84%E4%BE%8B%E5%AD%90.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/07/11/【DanBoneh】AuthenticatedEncryption/"/>





  <title>【DanBoneh】Authenticated Encryption | 鳕鱼堡er</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?702343d7b417e8c7fb52c949a3414d6c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">鳕鱼堡er</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">种一棵树 最好的时间是现在</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XUEYU">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鳕鱼堡er">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【DanBoneh】Authenticated Encryption</h1>
        

        <div class="post-meta">
          <span class="post-time">
			
			
			
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-11T08:43:14+08:00">
                2020-07-11
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-07-15T18:22:32+08:00">
                2020-07-15
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%8B%E8%B7%AF/" itemprop="url" rel="index">
                    <span itemprop="name">密码学之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/" class="leancloud_visitors" data-flag-title="【DanBoneh】Authenticated Encryption">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  11.6k字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  40分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="active-attack-on-cpa-secure-encryption"><a href="#Active-attack-on-CPA-secure-encryption" class="headerlink" title="Active attack on CPA-secure encryption"></a>Active attack on CPA-secure encryption</h1><h2 id="修改iv域的攻击例子"><a href="#修改IV域的攻击例子" class="headerlink" title="修改IV域的攻击例子"></a>修改IV域的攻击例子</h2><p>在这个攻击者的例子中，他们可以篡改通信，因此完全破坏了CPA安全加密的安全性。这告诉我们，实际上那种方法提供的完整性和私密性也会被破坏，换句话说，如果我们要安全地对抗主动型攻击者，完整性和私密性，两者都必须保证。</p>
<a id="more"></a>
<p>使用一个高度简化的 TCP/IP 版本，这样我们可以关注于攻击，不拘泥于细节。我们有两个机器互相通信，一用户坐在一台机器上，另一台机器是个服务器，现在，服务器上有 TCP/IP 协议栈在接收数据包，然后，根据这些数据包的目标地址域，服务器把数据包转发到合适的位置。比如，这里我们有两个进程在监听这些数据包，一个在网页服务器这里，另一个在用户 Bob 这里，网页服务器监听 80 端口，用户 Bob 监听 25 端口。现在，当一个数据包到来时，TCP/IP 协议栈查看目标端口，在这个情况下，端口号是 80 ，因此，协议栈把数据包转发到网页服务器，如果目标端口是 25 ，TCP/IP 协议栈会把数据包转发给 Bob 。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TCPIP%E7%9A%84%E4%BE%8B%E5%AD%90.PNG" class title="TCP&#x2F;IP的例子">
<p>现在，一个很有名的安全协议叫 IPsec ，加密了发送方和接收方之间的 IP 数据包，在这里，发送方和接收方共享一个密钥，当发送方发送 IP 数据包时，使用密钥 k 来加密这些 IP 包。现在，一个数据包到达了服务器，<u>TCP/IP 栈会解密这个数据包，然后看目标端口</u>，把数据包发送到合适的位置去解密，注意，这里的数据 data 是被加密的，这种情况下，因为目标端口是 80，会把数据发给网页服务器 ；如果目标端口正好是 25 ，TCP/IP 栈会解密这个包看目标端口，然后把明文数据 stuff 发给相应进程。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/IPsec.PNG" class title="IPsec">
<p>没有完整性的话，这里我们不能获得任何的私密性。为什么呢？想象一下攻击者截获了一个特定的给网页服务器的数据包，换句话说，这是个加密的目标端口为 80 的数据包，攻击者实际上可以接收任何给 25 端口的数据包的解密，因为 TCP 协议栈会乐意解密给 25 端口的数据包，并把结果给正在监听的 Bob（这里Bob是攻击者），Bob会截获途中的数据包，防止数据包到达服务器，而他将修改这个数据包，将目标端口改为 25 ，这在密文里完成。然后，当这个数据包到达服务器时，目标端口说是 25 ，服务器会解密这个数据包，就把数据转发给了 Bob。现在，Bob通过改变目标端口，就可以读到本不该给他的数据。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%8D%E8%83%BD%E8%8E%B7%E5%BE%97%E7%A7%81%E5%AF%86%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90.PNG" class title="不能获得私密性的例子">
<p>如果数据使用的是带随机 IV 的 CBC 加密（这是一个 CPA 安全的机制）的，如果是这种情况，攻击者很容易改变密文以获得新密文，其目标端口是 25 ，而非80，攻击者只需修改IV域即可。事实上，其他的一切都保持不变，攻击者捕捉的是一个 CBC 加密的数据包，从这个数据包里，攻击者知道了目标端口是 80 ，但不知道数据是什么，他的目标是构建一个新的加密的数据包，其目标端口是 25 。攻击者只需改变 IV ，而解密 CBC 加密的数据的方法是，本质上，第一个明文分组是第一个密文分组的解密再与 IV 异或的结果，在原数据包里会读到目标端口为 80 ，那么攻击者该如何修改 IV 使得目标端口读起来是 25 ？容易看出，如果攻击者取原 IV 和 …80… 、…25… 异或，然后容易看出这个新的 IV’ 与原密文信息一并发发送，当攻击者解密时，新的 IV’ 会抵消掉 80 异或 25 将目标端口变成 25 。这个简单的方法，通过修改 IV 域，攻击者可以重定向数据包。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E6%94%BB%E5%87%BB%E8%80%85%E6%94%B9%E5%8F%98IV%E7%9A%84%E6%96%B9%E5%BC%8F.PNG" class title="攻击者改变IV的方式">
<p>这个例子展示了，没有完整性（确保信息不被篡改），一个 CPA 安全的加密不可能提供私密性。如果攻击者可以在途中修改数据包，CPA 安全加密只能在<u>攻击者只能窃听数据的这一假设下</u>，提供私密性，但在例子中可以看到攻击者不能在途中修改密文（如果可以修改密文，一个简单的修改也会完全改变明文）。</p>
<h2 id="选择密文攻击的例子"><a href="#选择密文攻击的例子" class="headerlink" title="选择密文攻击的例子"></a>选择密文攻击的例子</h2><p>这是另外一个篡改攻击的例子，只需要能接收到网络流量即可，不需要攻击者在解密机器上操作。</p>
<p>有一个远程终端应用，每次用户敲击键盘，一个加密的键盘输入被送往服务器，我们假定键盘输入是使用计数器模式加密的，D 对应一个字节输入，每个 TCP/IP 包包含了一个校验和 T ，校验和只能使用于检测传输错误，如果服务器接收了一个含错误校验和的数据包，它就会简单地扔了这个包。现在攻击者想学习键盘输入的内容，他会截获这个数据包，不修改它，但他会记录下这个数据包，直接把包发给服务器，之后他会修改数据包，然后再把修改后的数据包发给服务器，他会把加密的校验和与一个值 t 异或，把加密的数据与一个值 s 异或，他用很多 t 和 s 来做这件事。计数器模式的一个性质是，如果你用 t 异或密文，解密后明文结果也是与 t 异或的。服务器解密这个修改后的数据包，得到的数据包有个异或了 t 的校验和，数据是异或了 s 的，如果修改的校验和对于这个修改的数据包来说是正确的，服务器会发送一个 ACK 应答包；如果不正确，服务器会扔掉这个数据包。所以攻击者可以根据能否收到 ACK 包学习到特定的 t 异或和 s 异或，是否对应一个有效的校验和，攻击者会学习到，如果我们修改了数据，把数据和特定值 s 异或，那么校验和就要与 t 异或，他学习到很多的 t 和 s 。根据如图所示方程，可以解出值 D 。这是一个很好的例子，被叫做<strong>选择密文攻击</strong>。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB%E7%9A%84%E4%BE%8B%E5%AD%90.PNG" class title="选择密文攻击的例子">
<p>我们可以看到许多这种攻击的例子，攻击者可以修改途中的通信，以上两个例子叫做<strong>主动攻击</strong>。</p>
<p>以上两个例子可以证明，只提供 CPA 安全，或者说对抗窃听的安全，对抗主动攻击者时不能保证安全，不仅密文没有完整性，而且甚至连私密性也没有。<strong>CPA 安全密码并不提供认证加密。</strong></p>
<p>如果你的信息<u>只需要完整性，不需要私密性</u>，使用 <strong>MAC</strong> 就足够了。</p>
<p>如果你的信息<u>需要完整性，也需要私密性</u>，那么必须使用<strong>认证加密模式</strong>。</p>
<p><strong>CPA 安全模式不应该被使用在加密数据上</strong>，带随机 IV 的 CBC 可以为认证加密构建分组，但不应被单独使用。</p>
<h1 id="definitions"><a href="#Definitions" class="headerlink" title="Definitions"></a>Definitions</h1><h2 id="认证加密"><a href="#认证加密" class="headerlink" title="认证加密"></a>认证加密</h2><p><strong>认证加密</strong>：即存在主动攻击也能保持安全。认证加密是一个密码，通常是个加密算法，取密钥、信息为输入，还可选一个新鲜值，输出一个密文。解密算法通常是输出一个信息，但是这个解密算法可以输出一个特殊符号，叫做 <strong>底⊥</strong> 。<u>当解密算法输出符号 ⊥ 时，意味着密文是无效的</u>，应当被忽略，唯一要求是这个 ⊥ 不在信息空间内，它表示密文应当被拒绝。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A4%E8%AF%81%E5%8A%A0%E5%AF%86%E5%AE%9A%E4%B9%89.PNG" class title="认证加密定义">
<h2 id="一个安全的认证加密系统"><a href="#一个安全的认证加密系统" class="headerlink" title="一个安全的认证加密系统"></a>一个安全的认证加密系统</h2><p>必须满足连个性质：</p>
<p>①这个系统必须<u>对选择明文攻击是语义安全的</u>。</p>
<p>②这个系统必须<u>满足密文完整性</u>。</p>
<p>这意味着，即使攻击者能看到许多密文，他也不应该能阐述另外一个能顺利解密的密文。</p>
<h2 id="密文完整性游戏"><a href="#密文完整性游戏" class="headerlink" title="密文完整性游戏"></a>密文完整性游戏</h2><p>这里 (E,D) 是一个信息空间 M 上的密码。通常，挑战者开始时选择一个随机密钥 k ，攻击者可以提交他选择的信息，收到这些信息的加密，如图，$c_1$ 是 $m_1$ 的加密，$m_1$ 由攻击者选择，攻击者可以反复这样操作，直到获得了 q 个信息的密文。<u>他的目标是产生某个新的有效密文</u>，如果这个攻击者产生的<u>新密文</u>被正确的解密了，即被解密成了不是符号 ⊥ 的东西，我们说攻击者赢得了游戏。通常我们定义在这个密文完整性游戏中，攻击者的优势为挑战者在游戏最后输出 1 的概率，如果事实上对所有的有效攻击者，其赢得游戏的优势都是可忽略的，我们说这个密码有<strong>密文完整性</strong>。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AF%86%E6%96%87%E5%AE%8C%E6%95%B4%E6%80%A7%E6%B8%B8%E6%88%8F.PNG" class title="密文完整性游戏">
<p>带随机 IV 的 CBC 不提供认证加密。因为对于攻击者来说，很容易赢得密文完整性游戏。攻击者提交一个密文，CBC 的解密算法从不输出符号 ⊥ ，他总是输出某些信息，攻击者轻松获得游戏胜利。（任何奇怪的随机密文都会被解密成某些不是符号 ⊥ 的东西。）</p>
<h2 id="认证加密的两个影响"><a href="#认证加密的两个影响" class="headerlink" title="认证加密的两个影响"></a>认证加密的两个影响</h2><h3 id="第一个影响认证"><a href="#第一个影响—认证" class="headerlink" title="第一个影响—认证"></a>第一个影响—认证</h3><p><strong>认证</strong>，意味着攻击者无法欺骗接收方 Bob ，让 Bob 认为 Alice 发送了一条她没有发过的信息。如图，攻击者与 Alice 互动，让她去加密任意他选择的信息，这是一个选择明文攻击，攻击者的目标是产生某些不是由 Alice 创造的密文，因为攻击者不能赢下这个密文完整性游戏，他不能做到，意味着当 Bob 接收能被加密算法正确解密的密文时，他知道信息一定来自某知道密钥 k 的人。特别地，如果 Alice 是唯一知道 k 的人，那么他知道密文确实是来自 Alice ，并非攻击者发出的某些修改。</p>
<p>唯一剩下的警告是，认证加密无法抵抗重放攻击。攻击者可以截获某些从 Alice 到 Bob 的密文，攻击者可以重放信息，这样重放的密文对 Bob 来说看起来也是有效的。比如，Alice 让 Bob 转账100元，重放密文会反复进行转账，因此，<strong>任何加密协议必须能防御重放攻击</strong>，但这是认证算法能直接阻止得了的。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BD%B1%E5%93%8D%E2%80%94%E8%AE%A4%E8%AF%81.PNG" class title="第一个影响—认证">
<h3 id="第二个影响它能抵抗一种非常强力的攻击者即实施选择密文攻击下节讨论"><a href="#第二个影响—它能抵抗一种非常强力的攻击者，即实施选择密文攻击（下节讨论）。" class="headerlink" title="第二个影响—它能抵抗一种非常强力的攻击者，即实施选择密文攻击（下节讨论）。"></a>第二个影响—它能抵抗一种非常强力的攻击者，即实施<strong>选择密文攻击</strong>（下节讨论）。</h3><h1 id="chosen-ciphertext-attacks"><a href="#Chosen-ciphertext-attacks" class="headerlink" title="Chosen ciphertext attacks"></a>Chosen ciphertext attacks</h1><p><strong>认证加密可以抵抗选择密文攻击</strong>。</p>
<p>前面讲过，攻击者有某个他想解密的密文 c ，攻击者可以欺骗解密服务器去解密某些密文，但这些密文还不是 c ，在这个例子里，攻击者可以获得特定密文的解密结果，但不会是全部的密文；在另一个例子里，攻击者可以通过提交密文给解密者来学到明文，在这个例子里，攻击者提交 TCP/IP 数据包给解密服务器，如果加密服务器发送 ACK 包，攻击者就知道了解密后的明文有一个有效的校验和，否则，解密后的明文没有有效的校验和。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB%E7%9A%84%E4%BE%8B%E5%AD%90%E5%9B%9E%E9%A1%BE.PNG" class title="选择密文攻击的例子回顾">
<p>为了解决选择密文攻击的威胁，我们定义一个非常广义的安全观点，叫做<strong>选择密文安全</strong>。在这里，攻击者可以进行<strong>选择明文攻击 CPA</strong> ，也可以进行<strong>选择密文攻击 CCA</strong> ，即，它可以获得他选择的任意信息的加密，也可以解密他选择的任意密文，而不是挑战密文。</p>
<p>在这个模型里，攻击者有特定的密文想解密，它可以与解密者互动，向解密者发送这些选择密文的询问，解密各种密文，除了挑战密文。攻击者的目标是<strong>破坏挑战密文的语义安全</strong>。</p>
<h2 id="选择密文安全"><a href="#选择密文安全" class="headerlink" title="选择密文安全"></a>选择密文安全</h2><p>通常，我们有一个密码 (E,D) ，我们将定义两个实验，实验0 和 实验1 。挑战者开始时选择一个随机密钥，现在攻击者提交询问给挑战者，每个询问可以是两种类型中的一种，可以是 CPA 也可以是 CCA 。</p>
<p>一个选择明文询问中，攻击者提交两个信息 $m_0$ 和 $m_1$ ，它们的长度相同，在 实验0 中，攻击者收到 $m_0$ 的加密结果，或者是，在 实验1 中，攻击者收到 $m_1$ 的加密结果。攻击者收到左边或右边的加密结果取决于我们是在 实验0 还是在 实验1 中。</p>
<p>一个选择密文询问中，攻击者提交他选择的任意密文，他获得密文的解密，唯一的限制是，他的密文不是选择明文攻击的询问中他所获得的密文之一。这不合理，因为攻击者可以通过 CPA 询问轻松获得密文，得到的是 $m_0$ 或 $m_1$ 加密的结果，如果攻击者可以提交特定密文的 CCA 询问，他会获得 $m_0$ 或 $m_1$ 作为答复，这样攻击者就会知道自己是在 实验0 还是 实验1 了。所以我们说，攻击者收到的 CPA 密文都是<strong>挑战密文</strong>，攻击者允许获得任何他选择的密文的解密结果，这些挑战密文除外。</p>
<p>通常，攻击者的目标是确定他是在 实验0 ，还是 实验1 。这是一个极为强大的攻击者，他可以获得除了挑战密文外，任意密文的解密结果，但他依然不能区分他是在 实验0 或 实验1 中，如果攻击者在 实验0 和 实验1 中表现一致，无法区分这两个实验，通常我们说密码是 CCA 安全（选择密文安全）的。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%9A%E4%B9%89.PNG" class title="选择密文安全的定义">
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%9A%E4%B9%892.PNG" class title="选择密文安全的定义2">
<h2 id="带随机-iv-的-cbc-不是-cca-安全的"><a href="#带随机-IV-的-CBC-不是-CCA-安全的" class="headerlink" title="带随机 IV 的 CBC 不是 CCA 安全的"></a>带随机 IV 的 CBC 不是 CCA 安全的</h2><p>一个简单的例子来证明，带随机 IV 的 CBC 不是 CCA 安全的，为什么呢？</p>
<p>攻击者在一开始提交两个不同的明文 $m_0$ 和 $m_1$ ，我们假定这两个信息都是单分组的，然后攻击者会获得 $m_0$ 或 $m_1$ 的加密结果，注意，密文只有一个分组，因为明文只有一个分组长。攻击者要修改这个得到的密文 c ，变成 c’ ，他仅仅是将 IV 异或 1 。给一个新的不同于 c 的 密文 c’ ，因此攻击者完全可以提交 c’ ，作为他的选择密文攻击的询问，他让挑战者为他解密 c’ ，由于 c’ ≠ c ，挑战者必须解密 c’ ，c’ 的解密是什么？（如果我们把 IV 异或 1 ，明文也会异或 1 。）现在攻击者收到了 $m_0$⊕1，或是 $m_1$⊕1，攻击者就可以完全确定他在 实验0 ，还是在 实验1 ，攻击者的优势是 1 ，因为他可以轻松确定他在哪个实验。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%B8%A6%E9%9A%8F%E6%9C%BAIV%E7%9A%84CBC%E4%B8%8D%E6%98%AFCCA%E5%AE%89%E5%85%A8%E7%9A%84.PNG" class title="带随机IV的CBC不是CCA安全的">
<h2 id="一个定理"><a href="#一个定理" class="headerlink" title="一个定理"></a>一个定理</h2><p><strong>如果密码能够提供认证加密，这个密码就可以抵抗选择密文攻击。</strong></p>
<p>如果我们有一个攻击者，提交了 q 个询问，换句话说，最多 q 个 CPA 询问和 q 个 CCA 询问，那么有两个有效的攻击者 $B_1$ 和 $B_2$ ，满足如下不等式：</p>
<script type="math/tex; mode=display">
Adv_{CCA}[A,E]\leq2q\cdot Adv_{CI}[B_1,E]+Adv_{CPA}[B_2,E]</script><p>由于这个机制有认证加密，</p>
<p>因为它是 <u>CPA 安全</u>的，因此不等式右侧第二个优势是可忽略的；</p>
<p>因为加密机制有<u>密文完整性</u>，因此不等式右侧第一个优势是可忽略的；</p>
<p>因此，攻击者赢得 CCA 游戏的优势，即不等式左侧的优势也是可忽略的。</p>
<h2 id="上述定理的证明"><a href="#上述定理的证明" class="headerlink" title="上述定理的证明"></a>上述定理的证明</h2><p>如图，我们有两份 CCA 游戏，左上为 实验0 ，左下为 实验1 。攻击者提交 CPA 询问和 CCA 询问，最后他输出一个特定的猜测 b，记为 b’ ，我们的目标是证明这个 b’ 在两种情况下都是不可区分的。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E1.PNG" class title="定理证明1">
<p>首先，我们稍微改变一下挑战者，不再输出 CCA 询问的解密，攻击者会输出符号 ⊥ ，每次攻击者提交一个 CCA 询问，挑战者都说符号 ⊥ ，以下两个游戏在事实上是不可区分的，攻击者无法进行区分。因为机制有密文完整性，攻击者不能产生一个密文不是从 $c_1$ 到 c_i-1 中的，可以解密到不是符号 ⊥ 的其他东西。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E2.PNG" class title="定理证明2">
<p>同样的事情应用在下面的游戏中，可以知道左右两个游戏不可区分。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E3.PNG" class title="定理证明3">
<p>因为选择密文的询问总是以同样的方式回复，不会给攻击者任何信息，攻击者总是知道我们会以符号 ⊥ 回复，所以我们可以去除这些询问，得到下图。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E5%AE%9A%E7%90%86%E8%AF%81%E6%98%8E4.PNG" class title="定理证明4">
<p>去除这些询问后，剩下的游戏看上去很熟悉，即，右上和右下的游戏是由 CPA 安全的定义得来的，由于这个机制是 CPA 安全的，我们得出右上和右下的游戏不可区分，从而，我们证明了以上四个游戏都是等价的，因此，攻击者不能区分 实验0 和 实验1 ，因此这个机制是 CCA 安全的。</p>
<p><strong>认证加密蕴含了对抗选择密文攻击的安全性</strong>。</p>
<h2 id="认证加密的局限"><a href="#认证加密的局限" class="headerlink" title="认证加密的局限"></a>认证加密的局限</h2><p>①它不能阻止重放攻击。</p>
<p>②如果解密者透露了更多关于为什么密文被拒绝的信息，解密者不仅仅输出符号 ⊥ ，它还输出更多信息。如，计时攻击。</p>
<h1 id="constructions-from-ciphers-and-macs"><a href="#Constructions-from-ciphers-and-MACs" class="headerlink" title="Constructions from ciphers and MACs"></a>Constructions from ciphers and MACs</h1><p>在软件项目中最常见的错误是<u>不正确地组合加密和完整性机制</u>。</p>
<h2 id="cpa-安全加密和-mac-的组合例子"><a href="#CPA-安全加密和-MAC-的组合例子" class="headerlink" title="CPA 安全加密和 MAC 的组合例子"></a>CPA 安全加密和 MAC 的组合例子</h2><p>在这三个例子里，有一个单独的密钥 $k_E$ 用来加密，一个单独的密钥 $k_I$ 用来 MAC ，这两个密钥相互独立，都是在会话建立阶段生成的。</p>
<p>第一个例子在 SSL 协议里，SSL 组合加密和 MAC ，希望能获得认证加密，组合方法如下：取明文 m 的 MAC ，使用 MAC 密钥 $k_I$ ，计算明文 m 的标签，然后把标签附在明文后面，然后加密这个明文和标签的联结，得到最终的密文。</p>
<p>第二个例子在 IPsec 中，取明文，首先加密这个明文，然后计算得到的<u>密文的标签</u>，把密文附在标签后。</p>
<p>第三个例子在 SSH 协议里，SSH 取明文，加密明文，计算<u>明文的标签</u>，把密文附在标签后。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/CPA%E5%AE%89%E5%85%A8%E5%8A%A0%E5%AF%86%E5%92%8CMAC%E7%9A%84%E7%BB%84%E5%90%88%E4%BE%8B%E5%AD%90.PNG" class title="CPA安全加密和MAC的组合例子">
<p>试想，以上三个例子哪个是安全的？</p>
<p>在 <u>SSH 方法</u>中，标签是由明文计算的，然后把标签以明文的方式附在密文的后面，这存在很大的问题，因为 MAC 本身不是为私密性设计的，<strong>MAC 仅为完整性设计</strong>，事实上，仅以输出明文中的几位作为 MAC 的话，也没有错，也是很好的标签。如果使用这个方法，会完全破坏 CPA 安全性，因为明文的若干位在 MAC 签名算法的输出密文里被泄露了，所以这个 SSH 方法尽管对于 SSH 这个协议本身来说没有问题，也没有因为这个组合而被破解，但一般还是<u>不建议使用</u>这种方法。SSH方法有时叫做“<u>加密且MAC</u>”。</p>
<p><u>IPsec 的方法更为推荐</u>，因为无论使用什么 CPA 安全系统和 MAC 密钥，组合总能提供认证加密。因为一旦我们加密了明文，明文的内容就被隐藏在密文里了，当我们计算密文的标签时，我们用这个标签给密文上了锁，确保没人能产生一个不同的密文看起来是有效的，因此保证了任何对密文的修改都会被解密者检测出来。IPsec有时叫做“<u>先加密后MAC</u>”。</p>
<p>在 <u>SSL 方法</u>中，有一些病态的例子，把 CPA 安全的加密系统和一个安全的 MAC 组合起来，结果却对一个选择密文攻击是脆弱的，所以 SSL 方法实际上不提供认证加密。这个发生的原因是，加密机制和 MAC 算法之间有一些不好的互动，事实上，会有一个选择密文攻击，因此 SSL 方法<u>不提供认证加密</u>。SSL 方法有时叫做“<u>先MAC后加密</u>”。（如果你使用<u>随机计数器模式</u>或<u>随机 CBC</u>，那么对那些 CPA 安全的加密机制，SSL 方法<u>提供了认证加密</u>，是安全的。事实上，如果你使用的是<u>随机计数器模式</u>，那么你的 <u>MAC 算法只要是一次性安全的就够了</u>，不需要是完全安全的 MAC，这样更高效。）</p>
<h2 id="认证加密的三个标准模式"><a href="#认证加密的三个标准模式" class="headerlink" title="认证加密的三个标准模式"></a>认证加密的三个标准模式</h2><p>一旦认证加密的观念变得更为流行，很多组合加密和 MAC 的标准方法便涌现出来。</p>
<p>GCM（Galois计数器模式）和 CCM（CBC计数器模式）是由 NIST 标准化的。</p>
<p><strong>GCM 的工作过程</strong>：使用了计数器模式加密，即使用 Carter-Wegman MAC 的随机计数器模式。GCM 的 Carter-Wegman MAC 如下工作，它是待求 MAC 的信息的一个哈希函数，然后用一个 PRF 加密哈希的结果，这个速度很快，而 GCM 的运行时间受制于计数器模式，为了更快，Intel 引入了一个特殊指令 PCLMULQDQ ，目标是让 GCM 的这个哈希函数跑得尽可能快。</p>
<p><strong>CCM 的工作过程</strong>：使用 CBC MAC ，然后用计数器模式加密，这个机制使用 MAC ，然后加密。<u>并不推荐使用</u>。但因为使用的是计数器模式，实际上是一个很好的加密机制。CCM 一切都是基于 AES 的，它的  CBC-MAC 使用了 AES，他的计数器模式也是使用 AES ，因此，CCM 可以用相对少的代码实现，因为需要的仅为 AES 引擎，因此，CCM 被 WIFI 采用。</p>
<p><strong>EAX 的工作过程</strong>：使用的是计数器加密模式，然后是 CMAC，先加密后 MAC 。</p>
<p>所有的这些模式都是<u>基于新鲜值的</u>，换句话说，它们不使用任何随机性，并且，每个密钥的新鲜值是唯一的，有序对（密钥，新鲜值）永远不应该重复使用，但新鲜值本身不一定是随机的，可以使用一个计数器。</p>
<p>所有的这些模式被称为<strong>带相关数据的认证加密</strong>（<strong>AEAD</strong>），这是一个认证加密的扩展，在网络协议中经常出现，AEAD 的想法是：<u>提供给加密模式的信息不被完全加密，只有部分信息是被加密的，但所有信息是被认证的</u>。网络数据包就是一个很好的例子，报文头不需要加密，封装数据需要加密，报文头和封装数据都需要被认证。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/AEAD.PNG" class title="AEAD">
<h2 id="mac-安全性的相关解释"><a href="#MAC-安全性的相关解释" class="headerlink" title="MAC 安全性的相关解释"></a>MAC 安全性的相关解释</h2><p>安全MAC 定义的要求之一是，给定信息 m 的信息、MAC 对，攻击者不能产生同样的信息 m 的另一个标签，换句话说即使攻击者已经有了信息 m 的一个标签，他也不能产生同样信息 m 的一个新的标签。</p>
<p>为什么呢？如果攻击者已经有了信息 m 的一个标签，谁在乎他是否能产生另一个标签？</p>
<p>实际上，如果 MAC 没有这一性质，那么这个 MAC 会造成一个不安全的“先加密后MAC”的模式，如果想要“先加密后MAC”具有密文完整性，很重要的一点是，我们的 MAC 安全性蕴含着这个安全观点（即，不能产生同样信息 m 的一个新的标签）。</p>
<p>事实上，容易出现“产生新标签”这种伪造，在一种“先加密后MAC”系统有一种选择密文攻击，意味着它并不提供认证加密，如图所示，一开始，攻击者发送两个信息 $m_0$ 和 $m_1$ ，通常他会收到 $m_0$ 或 $m_1$ 的加密结果，由于我们使用“先加密后MAC”，攻击者收到的密文记为 $c_0$ ，$c_0$ 上有一 MAC t ，攻击者可以产生同样信息的另一个 MAC  t’ ，于是他有了一个新的完全有效的密文 ($c_0$,t’) ，攻击者可以提交 c’ 的一个选择密文的询问，这是一个有效的选择密文的询问，因为它和 c 不同，挑战者将 c’ 的解密发送给攻击者，c’ 的解密为 $m_0$ 或 $m_1$ ，因此他能输出 b 的值，以优势 1 赢得这个机制。</p>
<p>由此证明，如果 MAC 安全性不蕴含着这个安全观点，那么在这个“先加密后MAC”系统有一种选择密文攻击，因此，它是不安全的。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/MAC%E5%AE%89%E5%85%A8%E6%80%A7.PNG" class title="MAC安全性">
<h2 id="ocb由分组密码构建的认证加密机制"><a href="#OCB（由分组密码构建的认证加密机制）" class="headerlink" title="OCB（由分组密码构建的认证加密机制）"></a>OCB（由分组密码构建的认证加密机制）</h2><p>如果考虑 MAC 和加密的组合是如何工作的，比如说计数器模式和 CMAC ，那么对每个明文分组，首先必须以计数器模式使用分组密码，然后必须再次使用分组密码运行 CBC-MAC ，这意味着，如果把 CPA 安全的加密和一个 MAC 组合起来，对每个明文分组必须计算分组密码两次，一次计算 MAC ，一次计算加密机制。</p>
<p>那么，我们能否由一个 PRP 直接构建一个认证加密机制？这样我们对每个分组只计算一次 PRP ，答案是肯定的，这个构造叫做 <strong>OCB</strong> 。OCB 比从加密和 MAC 分别构造的机制<u>快很多</u>。</p>
<p>如下图，在 OCB 里，我们输入明文，注意，OCB 是完全<strong>可并行</strong>的，每个分组可以被单独加密，另外，<strong>对每个明文分组，只需计算一次分组密码</strong>，然后在最后再计算一次分组密码，以构建认证标签，除去分组密码部分，OCB 的开销是最小的，只需要计算一个非常简单的函数 P ，新鲜值、密钥、分组计数器都给了 P 。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/OCB.PNG" class title="OCB">
<p>为什么 OCB 不是标准？OBC 没被应用的原因是各种各样的专利。。。</p>
<h2 id="一些性能参数"><a href="#一些性能参数" class="headerlink" title="一些性能参数"></a>一些性能参数</h2><p>如图，右边为不该用的模式的性能参数，因为它们只提供 CPA 安全，不提供对抗主动攻击的安全性。左侧为三种标准和 OCB 的性能参数。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%80%E4%BA%9B%E6%80%A7%E8%83%BD%E5%8F%82%E6%95%B0.PNG" class title="一些性能参数">
<p>GCM 虽然速度快，但在空间有限的硬件设备上，并不理想，因为它的实现需要更多的代码（Intel只需要很少代码）。</p>
<h1 id="case-studytls"><a href="#Case-study：TLS" class="headerlink" title="Case study：TLS"></a>Case study：TLS</h1><h2 id="tls-的工作过程"><a href="#TLS-的工作过程" class="headerlink" title="TLS 的工作过程"></a>TLS 的工作过程</h2><p>在 TLS 中，数据加密使用的协议叫做 <strong>TLS 记录协议</strong>，在这个协议栈，每个 TLS 记录都以一个报文头 HDR 开始，报文头后面接加密的数据，TLS 中记录的长度最多为 16KB ，如果需要发送多于 16KB 的数据，那么一个记录需要被拆分成多个记录。</p>
<p>现在，TLS 使用了单向密钥（从浏览器到服务器的单方向密钥），而从服务器到浏览器也有另一个密钥，服务器和浏览器双方都知道这两个密钥，两个密钥都是由 TLS 密钥交换协议生成的。</p>
<p>TLS 记录协议使用了所谓的<u>基于状态的加密</u>，意思是，每个数据包的加密是使用浏览器和服务器内部维护的特定状态来完成的。一些 64 位计数器，当会话被首次初始化后，这些计数器被初始化为 0 ，然后每次发送记录时，它们都增加。一个状态，两个计数器，这个状态存在于浏览器和服务器双方随着记录由以一方发送，另一方接收，状态被合理更新。</p>
<p>这些计数器的目的：<strong>阻止重放攻击</strong>。攻击者不能简单地保存记录，然后进行重放，因为计数器一定增加了。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TLS%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG" class title="TLS的工作过程">
<h2 id="tls记录协议的工作细节"><a href="#TLS记录协议的工作细节" class="headerlink" title="TLS记录协议的工作细节"></a>TLS记录协议的工作细节</h2><p>加密使用 AES-CBC ，MAC 使用 HMAC-SHA1 ，注意，TLS 使用了一个 MAC 然后加密。</p>
<p>浏览器给服务器发送数据，使用的是从浏览器到服务器的密钥，密钥本身是由 2 个密钥组成，一个 MAC 密钥 k_mac 和一个加密密钥 k_enc ，两个密钥在会话起始阶段就被协商好了，总的来说，从浏览器到服务器有 2 个密钥，从服务器到浏览器有 2 个密钥，一共有 4 个密钥。</p>
<p>TCL 数据包结构图如下。它以一个<u>报文头</u>开头，包含了数据包的类型、协议版本号以及数据包的长度。注意到数据包的长度是以明文形式发送的，加密数据、加密特定记录时，取密钥和当前状态为输入，工作流程如下：</p>
<p>①首先，计算数据的 MAC ，这是取 MAC 的实际的封装数据，报文头、计数器的当前值也在 MAC 的计算中。（所有计数器增加表示又一个记录被发送了。）即使计数器的值包含在标签里，注意，计数器的值实际上永远不会在记录中发送，它不用被放在记录里发送的原因是，另一端的服务器已经知道了计数器的值，所以不需要发送。这个标签计算的范围是三元组数据 [header,data,tag] 。</p>
<p>②把标签附在数据后面。由于是<strong>先 MAC 后加密</strong>，所以计算了 MAC 。我们会将数据和标签一并加密，所以报文头、数据和标签补齐到 AES 分组。</p>
<p>③用加密密钥来进行 CBC 加密。我们计算数据和标签的 CBC 加密，使用一个新鲜的随机 IV ，它会被嵌入到密文中。</p>
<p>④在结果前附上报文头、报文类型、版本号、长度，给出整个 TLS 记录，发送给服务器。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/TLS%E8%AE%B0%E5%BD%95%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%BB%86%E8%8A%82.PNG" class title="TLS记录协议的工作细节">
<p>以上是 TLS “先MAC后加密”的实现，唯一与“先MAC后加密”的区别在于，有一个状态，即这个计数器，被包含在 MAC 值里。</p>
<p><strong>为什么这个计数器能阻止重放攻击？</strong></p>
<p>我们看记录协议是如何解密到来的记录，以加密的记录 record 为输入，服务器又将使用对应的、从浏览器到服务器密钥 以及 从浏览器到服务器的计数器。</p>
<p>①首先，我们使用加密密钥来解密记录。</p>
<p>②解密后，检测补齐长度，如果补齐格式错误，它将发送一个坏记录 MAC 警告并断开连接。如果需要发送更多记录，那就必须协商一个新的会话密钥。如果补齐格式正确，去除补齐很容易，服务器只需看补齐的最后的字节，然后进行相应的去除。</p>
<p>③从记录中提取标签，这个网页数据藏在这个去除补齐后剩下的记录里，然后验证报文头、数据和计数器值的标签，如果 MAC 不能验证，将发送一个警告“坏记录 MAC”，然后断开连接；如果标签通过验证，就去除标签、报文头，剩下的就是明文数据。</p>
<p>现在可以看到，如果记录被重放了（即，攻击者记下了某个记录重放给服务器），那时，计数器的值已经变了，因此被重放的记录的标签将不会通过验证。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A1%E6%95%B0%E5%99%A8%E9%98%BB%E6%AD%A2%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E7%9A%84%E8%AF%81%E6%98%8E.PNG" class title="计数器阻止重放攻击的证明">
<p>这个方法“先MAC后加密”，不过只有当<u>解密时没有信息泄露</u>，才是认证加密。只要无法区分为什么密文被拒绝了（即，解密者暴露了拒绝的事实，但不说为什么拒绝），这就是一个认证加密系统。</p>
<p><strong>当解密失败时，只要输出拒绝，永远不要解释为什么拒绝</strong>。在密码学里，如果解释为什么失败，很可能会造成一个攻击。</p>
<h2 id="一个被破解的协议-80211b-wep"><a href="#一个被破解的协议-802-11b-WEP" class="headerlink" title="一个被破解的协议 802.11b WEP"></a>一个被破解的协议 802.11b WEP</h2><p><strong>802.11b WEP 工作流程</strong>：笔记本想发送一条信息给接入点，首先，笔记本计算信息的循环冗余校验码（CRC），然后把 CRC 校验码附在信息的后面，然后结果用流密码 RC4 加密。WEP 使用的密钥是一个初始 IV 值，这个 IV 每个数据包都会变，再联结上一个长密钥 k ，然后 IV 和密文一并传递给对方。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E4%B8%80%E4%B8%AA%E8%A2%AB%E7%A0%B4%E8%A7%A3%E7%9A%84%E5%8D%8F%E8%AE%AE.PNG" class title="一个被破解的协议">
<p><strong>存在的两个问题</strong>：</p>
<p>①IV 会重复。可以实施一个二次密码本攻击。</p>
<p>②使用了关联非常密切的密钥。密钥仅仅是 IV 联结上 k ，唯一改变的是 IV ，而 k 总是固定的。RC4 不是为这种用法而设计的，会完全被破解。</p>
<p><strong>攻击方法</strong>：</p>
<p>利用 CRC 校验和的一个性质，CRC 基本上是<u>线性</u>的，意思是如果我给你 CRC(m) ，可以很容易计算 CRC(m⊕p) ，只需要计算某个广为人知的函数 F(p) ，两者异或即可。异或从括号里提取出来，意味着 CRC 是线性的。</p>
<p>攻击如下，假设攻击者截获了某个送往接入点的数据包，现在数据包说，它的目标端口是 80 ，攻击者知道它是送往 80 端口的，攻击者想修改密文，使得目标端口变成 25 ，也许攻击者可以读取送往 25 端口的信息，CRC 校验和是为了确保攻击者不能修改密文中的数据，但事实上，非常容易修改密文数据，CRC 对篡改根本没有安全可言。</p>
<p>攻击者会对密文中代表 80 的那些字节异或某些特定的值 XX ，现在他会异或 25⊕80 ，如果异或特定字符串 XX 到密文里，密文由流密码生成，当密文解密时，此处的明文也会变成异或了 XX 后的样子，因此在解密后，这里的明文会变成 80⊕25⊕80=25 。</p>
<p>但是，如果我们只做这些，攻击还是会失败，因为 CRC 校验和现在还不是有效的，需要一个不同的 CRC ，但这不是问题，因为我们可以轻松修正这个 CRC 校验码，尽管 CRC 校验码也被加密了，我们把密文中对应 CRC 校验码的部分，与 F(XX) 异或，所以当密文解密后，我们会得到正确的 CRC 校验和。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95.PNG" class title="攻击方法">
<p><strong>结论</strong>：<strong>CRC 校验和完全不提供完整性来对抗主动攻击</strong>。</p>
<h1 id="cbc-padding-attacks"><a href="#CBC-padding-attacks" class="headerlink" title="CBC padding attacks"></a>CBC padding attacks</h1><p>一般情况下，当你想提供认证加密时，正确的方法是先加密，然后计算 MAC ，因为这样无论你组合什么加密和 MAC 算法，得到的结果将是认证加密。</p>
<p>假定这里的加密和 MAC 算法是正确实现的，我们看一个非常犀利的针对使用 CBC 加密的 TLS 记录协议的攻击。</p>
<p>TLS 解密时会发生两种错误：①补齐错误 ②MAC 错误</p>
<p>假设攻击者可以区分两种错误，得到的结果叫做<strong>补齐神谕</strong>。试想攻击者截获了一段特定的密文并试图去进行解密，它可以把这份密文提交给服务器，服务器会<u>解密这段密文</u>，然后<u>检查补齐格式是否正确</u>，如果补齐格式不正确，我们会得到一种错误类型；如果补齐格式正确，<u>检查 MAC</u> ，由于这段随机密文是攻击者捏造的，很可能是 MAC 错误的，然后攻击者会观测到一个 MAC 错误。所以如果补齐无效，我们会看到一个补齐错误；如果补齐有效，我们会看到一个 MAC 错误。因此，在向服务器提供密文后，攻击者可以知道解密的密文中最后几个字节是否是有效的补齐，这样攻击者仅仅通过提交密文给服务器，就学到了解密的密文中的一些信息。</p>
<p>那么，攻击者能否使用这个信息来完全解密一个给定的密文？<strong>一个补齐神谕，可以被用来完全解密一个给定的密文。</strong></p>
<h2 id="计时攻击"><a href="#计时攻击" class="headerlink" title="计时攻击"></a>计时攻击</h2><p>如果补齐无效，那么警告信息很快就会发出，在 21 毫秒内密文会被拒绝；如果补齐无效，检查 MAC ，发现 MAC 也是无效的，在 23 毫秒被拒绝，返回警告，即使返回同样的警告，攻击者可以观察警告信息生成的用时，如果时间较短，他就知道补齐是无效的，如果时间较长，他就知道补齐有效，MAC 无效。因此，攻击者有一个补齐神谕可以告诉他补齐是否有效。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%AE%A1%E6%97%B6%E6%94%BB%E5%87%BB.PNG" class title="计时攻击">
<h2 id="如何利用补齐神谕"><a href="#如何利用补齐神谕？" class="headerlink" title="如何利用补齐神谕？"></a>如何利用补齐神谕？</h2><p>如果攻击者有一个特定的密文 c ，它可以只使用补齐神谕就能完全解密这个密文。</p>
<p>假设攻击者想获取明文 m[1] ，这里有攻击者截获的密文，首先，他扔掉 c[2] </p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A8.PNG" class title="补齐神谕的使用">
<p>这样最后分组就是 c[1] ，即攻击者想解密的分组，现在假定他有一个特定的猜测 g ，对 m[1] 的最后一个字节进行猜测，g 是从0 到 255 的某个值。攻击者会计算 g⊕01，再异或分组 c[0] 的最后一个字节，当这两个密文分组被解密时，会发生什么？c[0] 被解密成什么我们不管，当 c[1] 被解密时，最后一个字节与这个修改的 c[0] 异或，得到明文的最后一个字节 将也是与这个多出来的、与 c[0] 异或的值 异或的，所以实际上原来明文 m[1] 的最后一个字节，现在与 g⊕01 异或了（图中0x表示十六进制）。</p>
<p>如果 m[1] 最后一个字节的猜测 g 是正确的，那么 last-byte⊕g 会抵消，last-byte⊕g=0，我们会得到明文的最后一个字节是 01 ，这意味着，如果我们对 m[1] 最后一个字节的猜测是正确的，那么我们获得了一个格式正确的补齐，补齐神谕说，这个补齐是有效的；如果猜测不正确，我们会得到一个不等于 1 的值，我们的补齐可能是无效的。可以看到，如果我们对 m[1] 最后一个字节的猜测是正确的，表示 g 实际上是正确的猜测；如果我们的猜测是错误的，g 就是错误的。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A82.PNG" class title="补齐神谕的使用2">
<p>那么，攻击者会创建他的修改后的密文，注意，他只修改密文的第二个分组，把这个发送给补齐神谕，根据补齐神谕返回的结果，我们可以知道最后一个字节是否等于 g 。</p>
<p>我们可以重复这一步，g 从0 遍历到 255 ，直到找到正确的 g，我们就知道了 m[1] 的最后一个字节。然后，我们可以使用一模一样的流程来学到 m[1] 中倒数第二个字节，我们使用两字节的补齐 (02,02) ，这是一个正确的补齐格式。当我们用异或的技巧时，我们可以总是确保明文的最后一个字节为 02 ，现在我们可以猜测 m[1] 的倒数第二个字节了，通过尝试很多 g ，直到找到那个可以造出补齐 22 的 g 。然后一次次迭代这个过程。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E8%A1%A5%E9%BD%90%E7%A5%9E%E8%B0%95%E7%9A%84%E4%BD%BF%E7%94%A83.PNG" class title="补齐神谕的使用3">
<p>这个攻击对于 TLS 不起作用，因为 TLS 接收到一个带有坏补齐或坏 MAC 记录时，它会关闭连接，然后重新协商一个新密钥，TLS 中只能提交一个询问，只会泄露单个询问的明文信息给攻击者，不会暴露整个明文分组。但这个攻击十分犀利，只要协议中有这样一个错误，攻击就会发生。</p>
<p><strong>防御这个攻击的方法</strong>是<strong>始终检查 MAC</strong> ，因此需要花同样的反应时间，看补齐是否有效，无论补齐是否有效，就防止了计时攻击，让这个攻击更加困难。</p>
<h2 id="两个教训"><a href="#两个教训" class="headerlink" title="两个教训"></a>两个教训</h2><p>①如果 TLS 先加密后 MAC ，而不是先 MAC 后加密，这个攻击将完全不顶用。</p>
<p>②MAC 和 CBC 确实提供了认证加密，但仅当不透露解密失败的原因，但以上实验证实了这种模式不能提供认证加密。</p>
<h1 id="attacking-non-atomic-decryption"><a href="#Attacking-non-atomic-decryption" class="headerlink" title="Attacking non-atomic decryption"></a>Attacking non-atomic decryption</h1><h2 id="针对ssh的二元数据包协议的攻击"><a href="#针对SSH的二元数据包协议的攻击" class="headerlink" title="针对SSH的二元数据包协议的攻击"></a>针对SSH的二元数据包协议的攻击</h2><p>SSH 是一个标准的安全远程 shell 应用，使用了一个客户端与服务端之间的协议，它有一个密钥交换机制，一旦双方交换密钥，SSH 使用所谓的二元数据包协议来在客户端和服务端之间相互发送信息。</p>
<p><strong>SSH工作过程</strong>：使用“加密且MAC”，每个 SSH 包以一个序列号开头，然后数据包包含了包的长度、CBC补齐的长度、封装数据、CBC补齐，图中红色快是用带链式 IV 的 CBC 加密的，所以这对 CPA 攻击也是脆弱的，计算整个<u>数据包的明文的 MAC</u> ，MAC 以<u>明文的形式</u>和数据包一起发送。SSH 解密过程如下：</p>
<p>①首先，服务器只解密加密的数据包的包长度域 packet len ，那么它只解密开头这几个字节。</p>
<p>②然后它从网络接着读取数据，读取的字节数由数据包长度域指定。</p>
<p>③SSH 使用 CBC 解密剩下的密文内容。</p>
<p>④一旦恢复了整个 SSH 数据包，它会接着检查明文的 MAC ，如果 MAC 无效，就报错。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/SSH%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.PNG" class title="SSH工作过程">
<p>这里的问题是，数据包长度域被解密了，然后被直接使用，以决定数据包的长度，这是在任何认证发生前，事实上，不可能认证数据包长度域的 MAC ，因为我们还没有还原整个数据包，所以我们还不能检查 MAC 。但是，SSH 协议在验证 MAC 之前就是用了数据包长度，这实际上引入了一个非常犀利的攻击。</p>
<p>我们只描述这个攻击的一个非常简化的版本，想法如下：假设攻击者截获了一个密文分组，即直接用 AES 加密的分组 m ，现在攻击者想还原 m ，这个截获密文只有一个 AES 分组长，攻击者向服务器发送一个数据包，数据包的开头是正常的，以一个序列号开头，然后他截获的密文 c 作为第一个分组，发送给服务器，服务器会解密第一个 AES 分组的前几个字节，他会把这前几个字节解读成数据包的长度域，接下来，服务器将期待着这么多字节，在验证 MAC 之前，攻击者将一次只给服务器一个字节，这样服务器会一个字节一个字节的读，最终，服务器会读到长度域里说的那么多的字节，他会检测 MAC 是否有效，由于攻击者给服务器的字节都是随便弄的，因此 MAC 不会通过验证，服务器会发送一个 MAC 错误，但是可以发现，攻击者在数他发送给服务器多少个字节，他能严格的知道他发送了多少个字节，当他接收到服务器发来的 MAC 错误，这就告诉攻击者，密文 c 的前 32 位的解密结果正好等于已经发送的字节数，在看到 MAC 错误之前，这是一个非常聪明的攻击，攻击者可以知道一条长信息的每个密文分组的高 32 位。</p>
<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/%E7%AE%80%E5%8C%96%E7%89%88%E6%9C%AC%E7%9A%84%E6%94%BB%E5%87%BB.PNG" class title="简化版本的攻击">
<p><strong>密码设计的两个错误</strong>：</p>
<p>①解密操作不是原子操作，换句话说，解密算法不取整个数据包作为输入，而返回整个明文作为输出，或者返回“拒绝”，解密算法部分地解密了密文，获得了长度域，然后等待指定数量的字节去还原，然后完成了解密过程。</p>
<p>②在正确的认证之前，就使用了长度域。</p>
<p><strong>重新设计SSH，如何最小的改动，可以让SSH抵抗这种攻击？</strong></p>
<p>方案①：以明文的形式发送一个长度域，就像 TLS 一样，这样，攻击者就没有机会提交选择密文攻击了，因为长度域不会被加密，攻击者无法滥用解密操作。</p>
<p>方案②：单独对长度域计算 MAC ，这样服务器可以去读长度域，检查仅为长度域服务的 MAC 是否有效，服务器就知道了接下来要读多少个字节，之后再检查整个数据包的 MAC 域。</p>
<p>方案③：可行，但效率极差，可能会让服务器遭受拒绝服务攻击。</p>
<p>Lesson<img src="/2020/07/11/%E3%80%90DanBoneh%E3%80%91AuthenticatedEncryption/Lesson.PNG" class title="Lesson"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i>
 密码学</a>
          
            <a href="/tags/DanBoneh%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i>
 DanBoneh密码学</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/10/%E3%80%90%E6%80%BB%E7%BB%93%E5%BD%92%E7%BA%B3%E3%80%91%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%E7%9F%A5%E8%AF%86%E7%82%B9%E4%B8%B2%E8%AE%B2/" rel="next" title="【总结归纳】哈希函数知识点串讲">
                <i class="fa fa-chevron-left"></i> 【总结归纳】哈希函数知识点串讲
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/07/15/%E3%80%90DanBoneh%E3%80%91OddsAndEnds/" rel="prev" title="【DanBoneh】Odds And Ends">
                【DanBoneh】Odds And Ends <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="XUEYU" />
            
              <p class="site-author-name" itemprop="name">XUEYU</p>
              <p class="site-description motion-element" itemprop="description">你只管善良，上天自有衡量。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
				<a href="/archives">

              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#active-attack-on-cpa-secure-encryption"><span class="nav-number">1.</span> <span class="nav-text">Active attack on CPA-secure encryption</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#修改iv域的攻击例子"><span class="nav-number">1.1.</span> <span class="nav-text">修改IV域的攻击例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#选择密文攻击的例子"><span class="nav-number">1.2.</span> <span class="nav-text">选择密文攻击的例子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#definitions"><span class="nav-number">2.</span> <span class="nav-text">Definitions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#认证加密"><span class="nav-number">2.1.</span> <span class="nav-text">认证加密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个安全的认证加密系统"><span class="nav-number">2.2.</span> <span class="nav-text">一个安全的认证加密系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#密文完整性游戏"><span class="nav-number">2.3.</span> <span class="nav-text">密文完整性游戏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#认证加密的两个影响"><span class="nav-number">2.4.</span> <span class="nav-text">认证加密的两个影响</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一个影响认证"><span class="nav-number">2.4.1.</span> <span class="nav-text">第一个影响—认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二个影响它能抵抗一种非常强力的攻击者即实施选择密文攻击下节讨论"><span class="nav-number">2.4.2.</span> <span class="nav-text">第二个影响—它能抵抗一种非常强力的攻击者，即实施选择密文攻击（下节讨论）。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#chosen-ciphertext-attacks"><span class="nav-number">3.</span> <span class="nav-text">Chosen ciphertext attacks</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#选择密文安全"><span class="nav-number">3.1.</span> <span class="nav-text">选择密文安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#带随机-iv-的-cbc-不是-cca-安全的"><span class="nav-number">3.2.</span> <span class="nav-text">带随机 IV 的 CBC 不是 CCA 安全的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个定理"><span class="nav-number">3.3.</span> <span class="nav-text">一个定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上述定理的证明"><span class="nav-number">3.4.</span> <span class="nav-text">上述定理的证明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#认证加密的局限"><span class="nav-number">3.5.</span> <span class="nav-text">认证加密的局限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#constructions-from-ciphers-and-macs"><span class="nav-number">4.</span> <span class="nav-text">Constructions from ciphers and MACs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cpa-安全加密和-mac-的组合例子"><span class="nav-number">4.1.</span> <span class="nav-text">CPA 安全加密和 MAC 的组合例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#认证加密的三个标准模式"><span class="nav-number">4.2.</span> <span class="nav-text">认证加密的三个标准模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mac-安全性的相关解释"><span class="nav-number">4.3.</span> <span class="nav-text">MAC 安全性的相关解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ocb由分组密码构建的认证加密机制"><span class="nav-number">4.4.</span> <span class="nav-text">OCB（由分组密码构建的认证加密机制）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一些性能参数"><span class="nav-number">4.5.</span> <span class="nav-text">一些性能参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#case-studytls"><span class="nav-number">5.</span> <span class="nav-text">Case study：TLS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tls-的工作过程"><span class="nav-number">5.1.</span> <span class="nav-text">TLS 的工作过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tls记录协议的工作细节"><span class="nav-number">5.2.</span> <span class="nav-text">TLS记录协议的工作细节</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个被破解的协议-80211b-wep"><span class="nav-number">5.3.</span> <span class="nav-text">一个被破解的协议 802.11b WEP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cbc-padding-attacks"><span class="nav-number">6.</span> <span class="nav-text">CBC padding attacks</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#计时攻击"><span class="nav-number">6.1.</span> <span class="nav-text">计时攻击</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何利用补齐神谕"><span class="nav-number">6.2.</span> <span class="nav-text">如何利用补齐神谕？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#两个教训"><span class="nav-number">6.3.</span> <span class="nav-text">两个教训</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#attacking-non-atomic-decryption"><span class="nav-number">7.</span> <span class="nav-text">Attacking non-atomic decryption</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#针对ssh的二元数据包协议的攻击"><span class="nav-number">7.1.</span> <span class="nav-text">针对SSH的二元数据包协议的攻击</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
	  
	  
		
		<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
		<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
		
		<div class="widget-wrap">
			<h3 class="widget-title"></h3>
			<div id="myCanvasContainer" class="widget tagcloud">
				<canvas width="200" height="200" id="resCanvas" style="width=100%">
					<ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DanBoneh%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">DanBoneh密码学</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/" rel="tag">Node</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdb/" rel="tag">gdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vps/" rel="tag">vps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E4%BA%8E%E9%85%8D%E5%AF%B9%E7%9A%84%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">基于配对的密码学</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag">密码学</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/" rel="tag">密码学原理与实践</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93%E5%BD%92%E7%BA%B3/" rel="tag">总结归纳</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E9%A2%98/" rel="tag">测试题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a><span class="tag-list-count">1</span></li></ul>
				</canvas>
			</div>
		</div>
		
		
		
		
<div style="">
  <canvas id="canvas" style="width:60%;" height="100" width="700">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
<!--访问量访问人数-->
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">
	  <span class="post-count">71.2k</span>
	</span>
	<span class="post-meta-divider">|</span>
	<span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>

&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
	<i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XUEYU</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




<span class="post-meta-divider">|</span>
<span id="timeDate"></span><span id="times"></span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("3/10/2020 12:00:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = " Running "+dnum+" Days "; 
    } 
setInterval("createtime()",250);
</script>
        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: false,
        appId: 'zSmUqaeGJut1H7flpYIH1eVP-gzGzoHsz',
        appKey: 'oNioHGf9lbC9krBNHyPsX05z',
        placeholder: '欢迎交流讨论...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("zSmUqaeGJut1H7flpYIH1eVP-gzGzoHsz", "oNioHGf9lbC9krBNHyPsX05z");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
  <!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
